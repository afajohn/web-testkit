# Scripts Directory

This directory contains utility scripts for the Playwright test suite.

## send-to-n8n.js

Sends Playwright test results to n8n webhook endpoint.

### Usage

```bash
# Send test results after running tests
node scripts/send-to-n8n.js

# Or use the npm script
npm run send:n8n
```

### Configuration

The script reads test results from `test-results.json` (generated by Playwright's JSON reporter) and sends them to n8n.

**Default webhook URL**: `http://localhost:5678/webhook-test/playwright-results`  
**Default HTTP method**: `GET` (sends data via query parameters)

**Note**: For GET requests, data is encoded as a query parameter. For POST requests, data is sent in the request body.

**Important**: 
- Use `/webhook/` path for **activated workflows** (production mode)
- Use `/webhook-test/` path only for **testing** (works once after clicking "Execute workflow")
- **Make sure your n8n workflow is ACTIVATED** for `/webhook/` to work

**Custom webhook URL**: Set the `N8N_WEBHOOK_URL` environment variable:

### Using with URL Testing

To test a specific URL and send results to n8n:

```bash
# Using npm script (note the -- before URL)
npm run test:url:n8n -- https://anewbride.com/

# Or use the script directly
node test-url-n8n.js https://anewbride.com/
```

The `--` is required when passing arguments through npm scripts.

Custom webhook URL (environment variable):

```bash
# Windows PowerShell
$env:N8N_WEBHOOK_URL="http://localhost:5678/webhook/playwright-results"
node scripts/send-to-n8n.js

# Windows CMD
set N8N_WEBHOOK_URL=http://localhost:5678/webhook/playwright-results
node scripts/send-to-n8n.js

# macOS/Linux
N8N_WEBHOOK_URL=http://localhost:5678/webhook/playwright-results node scripts/send-to-n8n.js
```

### Requirements

1. **n8n must be running** and accessible at the webhook URL
2. **test-results.json must exist** (generated after running tests)
3. **n8n workflow must be activated** with the webhook configured

### Output Format

The script sends the following payload to n8n:

```json
{
  "timestamp": "2024-01-01T12:00:00.000Z",
  "source": "playwright",
  "results": { /* Full Playwright test results JSON */ },
  "summary": {
    "total": 10,
    "passed": 8,
    "failed": 2,
    "skipped": 0,
    "duration": 5000
  }
}
```

### Troubleshooting

**Error: Test results file not found**
- Run tests first: `npm test`
- Ensure `playwright.config.ts` has JSON reporter configured

**Error: Connection refused / ECONNREFUSED**
- Make sure n8n is running: `n8n`
- Verify webhook URL is correct
- Check that n8n workflow is activated

**Error: Invalid webhook URL**
- Verify URL format: `http://localhost:5678/webhook/playwright-results`
- Check that the path matches your n8n webhook configuration

